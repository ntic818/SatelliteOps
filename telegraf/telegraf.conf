[agent]
  interval = "1s"
  flush_interval = "1s"
  round_interval = true

###############################################################################
# INPUTS: AMQP Consumer (RabbitMQ)
###############################################################################

# Raw telemetry
[[inputs.amqp_consumer]]
  url = "${RABBITMQ_URL}"
  queue = "telemetry_raw_queue"
  data_format = "json"
  tag_keys = ["status", "category"]
  json_time_key = "timestamp"
  json_time_format = "unix"
  fielddrop = ["timestamp"]

# Power telemetry
[[inputs.amqp_consumer]]
  url = "${RABBITMQ_URL}"
  queue = "telemetry_power_queue"
  data_format = "json"
  tag_keys = ["status", "category"]
  json_time_key = "timestamp"
  json_time_format = "unix"
  fielddrop = ["timestamp"]

# Health telemetry
[[inputs.amqp_consumer]]
  url = "${RABBITMQ_URL}"
  queue = "telemetry_health_queue"
  data_format = "json"
  tag_keys = ["status", "category"]
  json_time_key = "timestamp"
  json_time_format = "unix"
  fielddrop = ["timestamp"]

# Attitude telemetry
[[inputs.amqp_consumer]]
  url = "${RABBITMQ_URL}"
  queue = "telemetry_attitude_queue"
  data_format = "json"
  tag_keys = ["status", "category"]
  json_time_key = "timestamp"
  json_time_format = "unix"
  fielddrop = ["timestamp"]

# Environment telemetry
[[inputs.amqp_consumer]]
  url = "${RABBITMQ_URL}"
  queue = "telemetry_environment_queue"
  data_format = "json"
  tag_keys = ["status", "category"]
  json_time_key = "timestamp"
  json_time_format = "unix"
  fielddrop = ["timestamp"]

# =====================
# VSAT TELEMETRY
# =====================
[[inputs.amqp_consumer]]
  url = "${RABBITMQ_URL}"
  queue = "telemetry_vsat_queue"
  data_format = "json"
  tag_keys = ["category", "vsat_id", "vsat_ip"]
  json_time_key = "timestamp"
  json_time_format = "unix"
  fielddrop = ["timestamp"]

###############################################################################
# OUTPUTS: InfluxDB
###############################################################################

[[outputs.influxdb]]
  urls = ["${INFLUXDB_URL}"]
  database = "telemetry"
  username = "${INFLUXDB_USER}"
  password = "${INFLUXDB_USER_PASS}"
  timeout = "5s"

